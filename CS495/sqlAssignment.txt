PRAGMA foreign_keys = ON; 

CREATE TABLE Regions(
	RegionID INTEGER PRIMARY KEY,
	Name TEXT NOT NULL
);
CREATE TABLE Species(
	SpeciesID INTEGER PRIMARY KEY,
	Name TEXT NOT NULL
);
CREATE TABLE Regions_Species(
	RegionID INTEGER NOT NULL,
	SpeciesID INTEGER NOT NULL,
	PRIMARY KEY (RegionID, SpeciesID),
	FOREIGN KEY(RegionID) REFERENCES Regions(RegionID),
	FOREIGN KEY(SpeciesID) REFERENCES Species(SpeciesID)
);
CREATE TABLE Sightings(
	SightingID INTEGER PRIMARY KEY,
	SpeciesID INTEGER NOT NULL,
	SpotterID INTEGER NOT NULL,
	Latitude FLOAT NOT NULL,
	Longitude FLOAT NOT NULL,
	Date VARCHAR(10) NOT NULL,
	FOREIGN KEY(SpeciesID) REFERENCES Species(SpeciesID),
	FOREIGN KEY(SpotterID) REFERENCES Spotters(SpotterID)
	
);
!!!!!!CREATE TABLE Species_Sightings(
	SpeciesID INTEGER NOT NULL,
	SightingID INTEGER NOT NULL,
	PRIMARY KEY(SpeciesID, SightingID),
	FOREIGN KEY(SpeciesID) REFERENCES Species(SpeciesID),
	FOREIGN KEY(SightingID) REFERENCES Sightings(SightingID)
);
CREATE TABLE Spotters(
	SpotterID INTEGER PRIMARY KEY,
	Name TEXt NOT NULL
	
);
!!!!!!!CREATE TABLE Spotters_Sightings(
	SpeciesID INTEGER NOT NULL,
	SpotterID INTEGER NOT NULL,
	PRIMARY KEY(SpeciesID, SpotterID),
	FOREIGN KEY(SpeciesID) REFERENCES Species(SpeciesID),
	FOREIGN KEY(SpotterID) REFERENCES Spotters(SpotterID)
);

CREATE INDEX Idx_Spotter_Sighting ON Sightings(SpotterID);

INSERT INTO Species(Name) VALUES('House Finch');
INSERT INTO Species(Name) VALUES('Mallard');
INSERT INTO Species(Name) VALUES('Pine grosbeak');
INSERT INTO Species(Name) VALUES('Common starling');
INSERT INTO Species(Name) VALUES('Cassins finch');
INSERT INTO Species(Name) VALUES('California Condor');

INSERT INTO Regions(Name) VALUES('Midwest');
INSERT INTO Regions(Name) VALUES('Northeast');
INSERT INTO Regions(Name) VALUES('South');
INSERT INTO Regions(Name) VALUES('West');

INSERT INTO Spotters(Name) VALUES('JD');
INSERT INTO Spotters(Name) VALUES('Santa Clause');
INSERT INTO Spotters(Name) VALUES('Barack');


INSERT INTO Sightings VALUES(NULL, (SELECT SpeciesID FROM Species WHERE Name = 'House Finch'), 
(SELECT SpotterID FROM Spotters WHERE Name = 'JD'), 42.74, 92.305, 2024-11-13);

INSERT INTO Sightings VALUES(NULL, (SELECT SpeciesID FROM Species WHERE Name = 'Cassins finch'), 
(SELECT SpotterID FROM Spotters WHERE Name = 'Santa Clause'), 42.74, 92.305, 2024-11-13);

INSERT INTO Sightings VALUES(NULL, (SELECT SpeciesID FROM Species WHERE Name = 'Common starling'), 
(SELECT SpotterID FROM Spotters WHERE Name = 'Barack'), 42.74, 92.305, 2024-11-13);

INSERT INTO Sightings VALUES(NULL, (SELECT SpeciesID FROM Species WHERE Name = 'Pine grosbeak'), 
(SELECT SpotterID FROM Spotters WHERE Name = 'JD'), 42.74, 92.305, 2024-11-13);

SELECT Latitude, Longitude, Date FROM Sightings  WHERE SpotterID = (SELECT SpotterID FROM Spotters WHERE Name = 'JD') JOIN Species ON Sightings.SpeciesID = Species.SpeciesID;