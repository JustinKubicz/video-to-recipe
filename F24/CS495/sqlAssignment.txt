PRAGMA foreign_keys = ON; 

CREATE TABLE Regions(
	RegionID INTEGER PRIMARY KEY,
	Name TEXT NOT NULL
);
CREATE TABLE Species(
	SpeciesID INTEGER PRIMARY KEY,
	Name TEXT NOT NULL
);
CREATE TABLE Regions_Species(
	RegionID INTEGER NOT NULL,
	SpeciesID INTEGER NOT NULL,
	PRIMARY KEY (RegionID, SpeciesID),
	FOREIGN KEY(RegionID) REFERENCES Regions(RegionID),
	FOREIGN KEY(SpeciesID) REFERENCES Species(SpeciesID)
);
CREATE TABLE Sightings(
	SightingID INTEGER PRIMARY KEY,
	SpeciesID INTEGER,
	SpotterID INTEGER,
	Latitude FLOAT NOT NULL,
	Longitude FLOAT NOT NULL,
	Date VARCHAR(10) NOT NULL,
	FOREIGN KEY(SpeciesID) REFERENCES Species(SpeciesID),
	FOREIGN KEY(SpotterID) REFERENCES Spotters(SpotterID)
	
);

CREATE TABLE Spotters(
	SpotterID INTEGER PRIMARY KEY,
	Name TEXt NOT NULL
	
);


CREATE INDEX Idx_Spotter_Sighting ON Sightings(SpotterID);

INSERT INTO Species(Name) VALUES('House Finch');
INSERT INTO Species(Name) VALUES('Mallard');
INSERT INTO Species(Name) VALUES('Pine grosbeak');
INSERT INTO Species(Name) VALUES('Common starling');
INSERT INTO Species(Name) VALUES('Cassins finch');
INSERT INTO Species(Name) VALUES('California Condor');

INSERT INTO Regions(Name) VALUES('Midwest');
INSERT INTO Regions(Name) VALUES('Northeast');
INSERT INTO Regions(Name) VALUES('South');
INSERT INTO Regions(Name) VALUES('West');

INSERT INTO Spotters(Name) VALUES('JD');
INSERT INTO Spotters(Name) VALUES('Santa Clause');
INSERT INTO Spotters(Name) VALUES('Barack');

INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'West'),
	(SELECT SpeciesID FROM Species WHERE Name = 'House Finch')
);
INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'West'),
	(SELECT SpeciesID FROM Species WHERE Name = 'Mallard')
);
INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'Midwest'),
	(SELECT SpeciesID FROM Species WHERE Name = 'Mallard')
);
INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'Northeast'),
	(SELECT SpeciesID FROM Species WHERE Name = 'Mallard')
);
INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'South'),
	(SELECT SpeciesID FROM Species WHERE Name = 'Mallard')
);
INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'West'),
	(SELECT SpeciesID FROM Species WHERE Name = 'Pine grosbeak')
);
INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'Northeast'),
	(SELECT SpeciesID FROM Species WHERE Name = 'Pine grosbeak')
);
INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'West'),
	(SELECT SpeciesID FROM Species WHERE Name = 'Cassins finch')
);
INSERT INTO Regions_Species(RegionId, SpeciesID) VALUES (
	(SELECT RegionID FROM Regions WHERE Name = 'South'),
	(SELECT SpeciesID FROM Species WHERE Name = 'California Condor')
);

INSERT INTO Sightings VALUES(NULL, (SELECT SpeciesID FROM Species WHERE Name = 'House Finch'), 
(SELECT SpotterID FROM Spotters WHERE Name = 'JD'), 42.74, 92.305, 2024-11-13);

INSERT INTO Sightings VALUES(NULL, (SELECT SpeciesID FROM Species WHERE Name = 'Cassins finch'), 
(SELECT SpotterID FROM Spotters WHERE Name = 'Santa Clause'), 42.74, 92.305, 2024-11-13);

INSERT INTO Sightings VALUES(NULL, (SELECT SpeciesID FROM Species WHERE Name = 'Common starling'), 
(SELECT SpotterID FROM Spotters WHERE Name = 'Barack'), 42.74, 92.305, 2024-11-13);

INSERT INTO Sightings VALUES(NULL, (SELECT SpeciesID FROM Species WHERE Name = 'Pine grosbeak'), 
(SELECT SpotterID FROM Spotters WHERE Name = 'JD'), 42.74, 92.305, 2024-11-13);

SELECT 
	Latitude, Longitude, Date, Species.Name 
FROM 
	Sightings JOIN Species ON Sightings.SpeciesID = Species.SpeciesID 
WHERE 
	SpotterID = (SELECT SpotterID FROM Spotters WHERE Name = 'JD');

SELECT
	Regions_Species.SpeciesID, Regions.Name
FROM
	Regions_Species JOIN Regions ON Regions_Species.SpeciesID = (SELECT SpeciesID FROM Species WHERE SpeciesID = 1);


UPDATE Species SET Name = 'Gymnogyps californianus' WHERE Name = 'California Condor';

BEGIN;
	UPDATE OR ROLLBACK Sightings SET SpotterID = NULL WHERE SpotterID = 1;
	DELETE FROM Spotters WHERE SpotterID = 1;
COMMIT;
